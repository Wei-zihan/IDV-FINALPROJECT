<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messenger Guild - The Multiverse Odyssey</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* --- GLOBAL STYLES --- */
        html { scroll-behavior: smooth; }
        body { margin: 0; font-family: 'Nunito', sans-serif; color: white; background-color: #0a0e17; overflow-x: hidden; }
        body.noscroll { overflow: hidden; height: 100vh; }
        h2 { font-size: 2.5rem; margin-bottom: 1rem; background: linear-gradient(to right, #a5f3fc, #ffffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h3 { font-size: 1.8rem; margin: 0.5rem 0; }
        p { line-height: 1.8; color: #d1d5db; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* --- HERO SECTION --- */
        .hero-section { position: relative; height: 100vh; width: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; background-color: #000; }
        .bg-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; filter: brightness(0.8); transition: opacity 0.5s; }
        .bg-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 2; opacity: 0; visibility: hidden; transition: opacity 0.8s ease-in-out; }
        .hero-section.video-mode .bg-video { opacity: 1; visibility: visible; }
        .hero-content { max-width: 800px; padding: 0 20px; z-index: 10; position: relative; opacity: 1; transition: opacity 0.5s ease-out, transform 0.5s; }
        .hero-section.video-mode .hero-content { opacity: 0; pointer-events: none; transform: scale(0.95); }
        .hero-section.video-mode .navbar { opacity: 0; pointer-events: none; }
        
        .navbar { position: fixed; top: 0; width: 100%; padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; z-index: 100; background: linear-gradient(to bottom, rgba(10,14,23,0.9), transparent); transition: opacity 0.5s, background 0.3s; }
        .navbar.scrolled { background-color: #0a0e17; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .logo { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; cursor: pointer; }
        .menu a { color: white; text-decoration: none; margin-left: 2rem; font-weight: 700; transition: color 0.3s; }
        .menu a:hover { color: #FFD700; }
        
        h1 { font-size: 4rem; line-height: 1.1; margin-bottom: 1.5rem; text-shadow: 0 4px 10px rgba(0,0,0,0.6); background: linear-gradient(to right, #ffffff, #a5f3fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #0a0e17; padding: 1rem 2.5rem; border-radius: 50px; font-weight: 900; text-decoration: none; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); transition: transform 0.3s, box-shadow 0.3s; margin-top: 2rem; cursor: pointer; }
        .cta-button:hover { transform: translateY(-3px); box-shadow: 0 0 30px rgba(255, 215, 0, 0.7); }

        /* --- WATCH TRANSITION --- */
        #transition-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; display: none; overflow: hidden; }
        .watch-graphic { position: absolute; top: 50%; left: 100%; transform: translateY(-50%) rotate(20deg); height: 80vh; width: auto; display: block; }
        .watch-active .watch-graphic { animation: watchSwipeAnim 2s cubic-bezier(0.65, 0, 0.35, 1) forwards; }
        #black-fade-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 9998; opacity: 0; pointer-events: none; transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes watchSwipeAnim {
            0% { left: 100%; transform: translateY(-50%) rotate(20deg); }
            40% { left: 0%; transform: translateY(-50%) rotate(0deg); }
            60% { left: -20%; transform: translateY(-50%) rotate(-10deg); }
            100% { left: -150%; transform: translateY(-50%) rotate(-30deg); }
        }

        /* --- COLLAPSE ANIMATION --- */
        @keyframes singularityCollapse {
            0% { transform: scale(1); filter: blur(0px) brightness(1); opacity: 1; }
            40% { transform: scale(1.02); filter: blur(0px) brightness(1.2); }
            100% { transform: scale(0.01); filter: blur(10px) brightness(3); opacity: 0; }
        }
        .section-collapsing { animation: singularityCollapse 0.8s cubic-bezier(0.7, 0, 0.84, 0) forwards; pointer-events: none; }

        /* --- SECTION 2 --- */
        #story { position: relative; height: 100vh; width: 100%; display: flex; align-items: flex-start; justify-content: flex-end; overflow: hidden; padding: 0; opacity: 1; transition: opacity 1.5s ease; cursor: pointer; }
        .story-hidden { opacity: 0 !important; }
        #story::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('image/book_bgf.png'); background-size: cover; background-position: center; z-index: 0; }
        #story::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; background: linear-gradient(to bottom, #000000 0%, #000000 15%, transparent 40%, transparent 80%, #0a0e17 100%); }
        .story-content-overlay { position: relative; z-index: 10; margin-top: 80px; padding: 4rem 4rem 6rem 6rem; max-width: 650px; text-align: right; background: linear-gradient(to bottom left, rgba(10, 14, 23, 0.9), transparent 70%); border-bottom-left-radius: 50px; pointer-events: auto; transition: opacity 0.3s; }
        .movie-subtitle { position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%); width: 80%; text-align: center; z-index: 20; font-size: 1.4rem; color: #ffffff; font-style: italic; line-height: 1.5; letter-spacing: 1px; pointer-events: none; text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000, 0 0 10px rgba(0,0,0,0.5); }
        #magic-trail { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; }

        /* --- SECTION 3: GUARDIANS --- */
        #guardians { padding: 120px 0; background-color: #0a0e17; }
        .section-header { text-align: center; margin-bottom: 80px; }
        #guardians .container { max-width: 95%; } 
        .guardians-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px; padding: 0 20px; }
        .guardian-card { position: relative; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 40px; padding: 60px 40px; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: center; overflow: visible; box-shadow: 0 15px 40px rgba(0,0,0,0.6); cursor: pointer; }
        .guardian-card:hover { transform: translateY(-15px) scale(1.02); background: rgba(255, 255, 255, 0.08); }
        .guardian-card h3 { font-size: 3rem; margin-top: 10px; margin-bottom: 15px; } 
        .guardian-card p { font-size: 1.3rem; }
        .guardian-avatar { width: 280px; height: 280px; border-radius: 50%; margin: 0 auto; object-fit: cover; border: 8px solid rgba(255,255,255,0.15); box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: block; }
        .guardian-logo { width: 112px; height: 90px; margin: 20px auto 30px auto; position: relative; z-index: 5; display: block; background-color: transparent; border: none; box-shadow: none; border-radius: 0; object-fit: contain; }
        .role-tag { display: inline-block; padding: 10px 30px; border-radius: 40px; font-size: 1.2rem; font-weight: 900; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px; }
        .role-apprentice { background: rgba(255, 215, 0, 0.2); color: #FFD700; border: 1px solid rgba(255, 215, 0, 0.4); }
        .role-mage { background: rgba(0, 191, 255, 0.2); color: #00BFFF; border: 1px solid rgba(0, 191, 255, 0.4); }
        .role-mentor { background: rgba(139, 69, 19, 0.3); color: #FFA07A; border: 1px solid rgba(255, 160, 122, 0.4); }

        /* --- SECTION 3.x: RPG CARD DETAILS --- */
        .char-stats-section { padding: 80px 0; background-color: #0d121d; border-top: 1px solid rgba(255,255,255,0.05); }
        .char-stats-section .container { max-width: 95%; }
        .rpg-layout-grid { display: grid; grid-template-columns: 500px 1fr; gap: 100px; align-items: center; }
        .rpg-card { position: relative; width: 100%; height: 750px; background: #111; border-radius: 30px; overflow: hidden; box-shadow: 0 30px 80px rgba(0,0,0,0.9); border: 3px solid #333; display: flex; flex-direction: column; }
        .rpg-card-visual { flex: 1; position: relative; background: radial-gradient(circle at center, #2a2a2a, #000); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 30px; overflow: hidden; pointer-events: auto; }
        .rpg-badge { background: #fff; color: #000; padding: 6px 20px; border-radius: 20px; font-size: 0.9rem; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; z-index: 10; margin-bottom: 10px; pointer-events: none; }
        .rpg-name { font-size: 2rem; font-weight: 800; color: white; z-index: 10; text-shadow: 0 4px 10px rgba(0,0,0,0.8); pointer-events: none; }
        .rpg-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); font-size: 5rem; font-weight: 900; color: rgba(255,255,255,0.03); white-space: nowrap; pointer-events: none; z-index: 1; }
        .rpg-bg-texture { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 110%; height: auto; z-index: 2; opacity: 0.5; pointer-events: none; mix-blend-mode: screen; }
        .rpg-visual-container { position: relative; width: 95%; height: auto; max-height: 480px; margin-top: 10px; z-index: 5; transition: transform 0.3s ease; }
        .rpg-char-img.static-pose { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.6)); transition: opacity 0.3s ease; opacity: 1; display: block; }
        .rpg-char-vid.loop-anim { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.8)); transition: opacity 0.3s ease; opacity: 0; pointer-events: none; }
        .rpg-card-visual.is-hovering .rpg-char-img.static-pose { opacity: 0; }
        .rpg-card-visual.is-hovering .rpg-char-vid.loop-anim { opacity: 1; }
        .rpg-card:hover .rpg-visual-container { transform: scale(1.05); }
        .rpg-faction-logo { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 60px; height: auto; z-index: 10; filter: drop-shadow(0 0 8px rgba(255,255,255,0.4)); pointer-events: none; }
        .rpg-card-stats { height: 120px; background: #0a0e14; border-top: 2px solid #333; display: flex; justify-content: space-around; align-items: center; padding: 0 30px; z-index: 15; }
        .rpg-stat-item { text-align: center; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .rpg-stat-label { font-size: 0.8rem; color: #888; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; }
        .rpg-stat-val { font-size: 2.2rem; font-weight: 900; color: white; }
        .rpg-stat-icon { font-size: 1.5rem; margin-bottom: 5px; color: #ffffff !important; }
        .rpg-data-panel { color: white; padding: 20px; display: flex; flex-direction: column; justify-content: flex-start; height: 100%; }
        .rpg-section-title { font-size: 3.5rem; margin-bottom: 40px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .charts-row { display: flex; gap: 40px; margin-bottom: 40px; align-items: center; }
        .radar-box { flex: 1; height: 400px; position: relative; }
        .bar-box { flex: 1; height: 350px; position: relative; background: rgba(0,0,0,0.2); border-radius: 20px; padding: 20px; }
        .rpg-desc-box { margin-top: 20px; padding: 40px; background: rgba(255,255,255,0.03); border-radius: 20px; border-left: 6px solid #aaa; }
        .rpg-desc-box h4 { margin: 0 0 15px 0; font-size: 2rem; }
        .rpg-desc-box p { font-size: 1.4rem; color: #ccc; margin: 0; line-height: 1.8; }
        #detail-resonator .rpg-desc-box { border-color: #FFD700; } #detail-resonator .rpg-desc-box h4 { color: #FFD700; }
        #detail-walker .rpg-desc-box { border-color: #00BFFF; } #detail-walker .rpg-desc-box h4 { color: #00BFFF; }
        #detail-weaver .rpg-desc-box { border-color: #C2412E; } #detail-weaver .rpg-desc-box h4 { color: #C2412E; }

        /* --- SECTION 4: HOLOGRAPHIC LANDSCAPES --- */
        #landscapes {
            position: relative;
            height: 100vh;
            background: radial-gradient(circle at center, #0f1420 0%, #0a0e17 100%);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0;
        }
        
        #globe-canvas-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        #hologram-ui-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        #center-info-display {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 5;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Center Logo Image Style */
        #center-loc-logo {
            display: block;
            height: 0; 
            opacity: 0;
            transition: all 0.5s ease;
            object-fit: contain;
            margin-bottom: 0;
        }
        
        /* 激活状态 */
        .center-logo-active {
            height: 75px !important; 
            opacity: 1 !important;
            margin-bottom: 20px !important;
        }

        #center-info-display h2 { font-size: 4rem; margin: 0; color: #fff; letter-spacing: 2px; }
        
        #center-info-display p { 
            font-family: 'Nunito', sans-serif;
            font-size: 1.5rem; 
            color: #a5f3fc; 
            letter-spacing: 2px; 
            margin-top: 10px; 
            font-weight: 700;
            text-shadow: none;
            text-transform: none;
            transition: all 0.5s ease;
        }

        .coord-active {
            font-size: 3rem !important; 
            font-weight: 900 !important;
            text-shadow: 0 0 15px rgba(165, 243, 252, 0.8) !important;
            text-transform: uppercase !important;
        }

        /* [新增] GO TO 按钮样式 */
        #center-go-btn {
            display: inline-block;
            margin-top: 25px;
            padding: 12px 40px;
            background: rgba(165, 243, 252, 0.1);
            border: 1px solid #a5f3fc;
            color: #a5f3fc;
            text-decoration: none;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
            border-radius: 30px;
            box-shadow: 0 0 10px rgba(165, 243, 252, 0.3);
            transition: all 0.3s ease;
            opacity: 0;           /* 默认隐藏 */
            pointer-events: none; /* 隐藏时不可点击 */
            transform: translateY(15px);
            font-size: 1.2rem;
        }
        
        #center-go-btn.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        #center-go-btn:hover {
            background: #a5f3fc;
            color: #000;
            box-shadow: 0 0 25px #a5f3fc;
        }

        #connector-lines-svg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none;
        }
        .connector-line { stroke: #a5f3fc; stroke-width: 2; stroke-dasharray: 5, 5; opacity: 0.8; filter: drop-shadow(0 0 5px #a5f3fc); }

        .location-buttons-container {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 60px; 
            pointer-events: auto; 
        }
        .buttons-left { left: 8%; align-items: flex-start; }
        .buttons-right { right: 8%; align-items: flex-end; }

        .hologram-btn {
            background: rgba(10, 14, 23, 0.6);
            border: 2px solid rgba(165, 243, 252, 0.5);
            color: #a5f3fc;
            padding: 20px 40px;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(8px);
            box-shadow: 0 0 15px rgba(165, 243, 252, 0.2);
            text-align: left;
            min-width: 280px;
        }
        .hologram-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(165, 243, 252, 0.4), transparent); transition: 0.5s; }
        .hologram-btn:hover { background: rgba(165, 243, 252, 0.3); box-shadow: 0 0 30px rgba(165, 243, 252, 0.6); border-color: #fff; }
        .hologram-btn:hover::before { left: 100%; }
        .buttons-right .hologram-btn { text-align: right; }
        .btn-subtitle { display: block; font-size: 0.9rem; opacity: 0.8; margin-top: 8px; text-transform: none; color: #fff; }

        .globe-marker-label {
            position: absolute;
            color: #000;
            background: #a5f3fc;
            padding: 4px 8px;
            border-radius: 2px;
            font-size: 0.8rem;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            transform: translate(-50%, -150%);
            white-space: nowrap;
            box-shadow: 0 0 15px #a5f3fc;
        }
        .globe-marker-label.active { opacity: 1; }

		/* --- SECTION 5: FINAL BACKGROUND --- */
		        #final-scene {
		            position: relative;
		            width: 100%;
		            height: 100vh; /* 占据整个屏幕高度 */
		            background-image: url('image/msgbgfin.png'); /* 假设图片在 image 文件夹下 */
		            background-size: cover; /* 保持比例填满屏幕 */
		            background-position: top; /* 图片居中 */
		            background-repeat: no-repeat;
		            z-index: 1;
		        }
        /* --- FOOTER --- */
        footer { padding: 40px; text-align: center; border-top: 1px solid rgba(255,255,255,0.05); color: #666; font-size: 0.9rem; }

        @media (max-width: 1200px) { .rpg-layout-grid { grid-template-columns: 400px 1fr; gap: 60px; } .rpg-card { height: 600px; } .charts-row { flex-direction: column; } .radar-box, .bar-box { width: 100%; height: 300px; } }
        @media (max-width: 768px) {
            .rpg-layout-grid { grid-template-columns: 1fr; } .rpg-card { width: 100%; max-width: 380px; height: 600px; margin: 0 auto; } .rpg-data-panel { padding: 0; margin-top: 40px; }
            .location-buttons-container { position: relative; top: auto; transform: none; flex-direction: row; justify-content: center; flex-wrap: wrap; gap: 20px; margin-top: 450px; pointer-events: auto; }
            .buttons-left, .buttons-right { left: auto; right: auto; }
            .hologram-btn { text-align: center; min-width: auto; padding: 10px 20px; font-size: 1rem; }
            #center-info-display { top: 20%; transform: translate(-50%, 0); }
            #center-info-display h2 { font-size: 2.5rem; }
            #center-info-display p { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <div id="transition-overlay">
        <img src="image/watch.png" alt="Giant Pocket Watch" class="watch-graphic">
    </div>
    <div id="black-fade-overlay"></div>

    <section class="hero-section" id="heroSection">
        <img src="image/first.png" alt="Messenger Guild World" class="bg-image">
        <video id="introVideo" class="bg-video" muted playsinline>
            <source src="video/intro.mp4" type="video/mp4">
        </video>
        <nav class="navbar" id="navbar">
            <div class="logo" onclick="window.scrollTo(0,0)">MESSENGER GUILD</div>
            <div class="menu">
                <a href="#story">The Story</a>
                <a href="#guardians">Guardians</a>
                <a href="#landscapes">Landscapes</a>
            </div>
        </nav>
        <div class="hero-content" id="heroContent">
            <h1>Mending the <br>Fractured Multiverse</h1>
            <p class="subtitle">The Truth Gem has shattered. Time is collapsing.<br>Join the Time-Space Guardian Apprentices to reclaim the shards.</p>
            <a href="javascript:void(0)" id="startBtn" class="cta-button">Begin the Odyssey</a>
        </div>
    </section>

    <section id="story">
        <canvas id="magic-trail"></canvas>
        <div class="movie-subtitle">
            "It's so beautiful, the Gem of Truth has never been so bright! <br> This is not good news, everyone be careful!"
        </div>
        <div class="story-content-overlay">
            <h2>The Anchor of Reality</h2>
            <p>
                At the core of all timelines lies the <strong>Messenger Guild</strong>. Here rests the <em>Book of Truth</em> and the Truth Gem—artifacts forged from Ocean, Forest, and Earth elements that govern the flow of existence.
            </p>
            <p>
                But the gem has fractured. "Interstice Zones" are tearing reality apart, unleashing void monsters. The only hope is to gather every shard and reboot the cosmic order.
            </p>
        </div>
    </section>

    <section id="guardians">
        <div class="container">
            <div class="section-header"><h2>The Guardians</h2><p>Three heroes. Three destinies. One mission.</p></div>
            <div class="guardians-grid">
                <div class="guardian-card" data-target="detail-resonator">
                    <img src="image/ghfix.png" alt="The Resonator" class="guardian-avatar">
                    <img src="image/guidepure.png" class="guardian-logo" alt="Messenger Logo">
                    <span class="role-tag role-apprentice">Apprentice</span>
                    <h3>The Resonator</h3>
                    <p>Dressed in her signature yellow cloak, she possesses a unique gift: the ability to hear the "song" of the Truth Gem shards across dimensions.</p>
                </div>
                <div class="guardian-card" data-target="detail-walker">
                    <img src="image/bohfix.png" alt="The Time Walker" class="guardian-avatar">
                    <img src="image/guidepure.png" class="guardian-logo" alt="Messenger Logo">
                    <span class="role-tag role-mage">Navigator</span>
                    <h3>The Time Walker</h3>
                    <p>Beneath his blue hood lies a mind sharp enough to calculate jumps through fractured timelines using basic elemental magic.</p>
                </div>
                <div class="guardian-card" data-target="detail-weaver">
                    <img src="image/bhfix.png" alt="Time Weaver" class="guardian-avatar">
                    <img src="image/starpure.png" class="guardian-logo" alt="Keeper Logo">
                    <span class="role-tag role-mentor">Mentor</span>
                    <h3>Time Weaver</h3>
                    <p>A master of Truth Constructs disguised as a plush bear. It shapes energy into tools and guides the apprentices through danger.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="detail-resonator" class="char-stats-section">
        <div class="container">
            <div class="rpg-layout-grid">
                <div class="rpg-card">
                    <div class="rpg-card-visual">
                        <span class="rpg-badge" style="background:#FFD700;">APPRENTICE</span>
                        <span class="rpg-name">The Resonator</span>
                        <div class="rpg-watermark">MESSENGER</div>
                        <img src="image/magic_circle_bg.png" class="rpg-bg-texture" alt="Magic Background">

                        <div class="rpg-visual-container">
                             <img src="image/girlcard.png" class="rpg-char-img static-pose" alt="Resonator Static">
                             <video class="rpg-char-vid loop-anim" muted loop playsinline preload="metadata">
                                 <source src="video/girl_loop.mp4" type="video/mp4">
                             </video>
                        </div>
                        <img src="image/guidepure.png" class="rpg-faction-logo" alt="Logo 1">
                    </div>
                    <div class="rpg-card-stats">
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-flask rpg-stat-icon"></i>
                            <span class="rpg-stat-label" style="color:#FFD700;">MANA</span>
                            <span class="rpg-stat-val">96</span>
                        </div>
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-khanda rpg-stat-icon"></i>
                            <span class="rpg-stat-label">ATK</span>
                            <span class="rpg-stat-val">30</span>
                        </div>
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-heart rpg-stat-icon"></i>
                            <span class="rpg-stat-label">LIFE</span>
                            <span class="rpg-stat-val">50</span>
                        </div>
                    </div>
                </div>
                <div class="rpg-data-panel">
                    <h3 class="rpg-section-title" style="border-color:#FFD700;">Attribute Analysis</h3>
                    <div class="charts-row">
                        <div class="radar-box"><canvas id="radarResonator"></canvas></div>
                        <div class="bar-box"><canvas id="barResonator"></canvas></div>
                    </div>
                    <div class="rpg-desc-box">
                        <h4>Class Overview: Gem Whisperer</h4>
                        <p>High sensitivity to magical energy allows her to detect Truth Shards from great distances. While lacking in physical durability, her mana reserves are exceptional, making her the key sensor of the team.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="detail-walker" class="char-stats-section">
        <div class="container">
            <div class="rpg-layout-grid">
                <div class="rpg-card">
                    <div class="rpg-card-visual">
                        <span class="rpg-badge" style="background:#00BFFF;">NAVIGATOR</span>
                        <span class="rpg-name">The Time Walker</span>
                        <div class="rpg-watermark">MESSENGER</div>
                        <img src="image/magic_circle_bg.png" class="rpg-bg-texture" alt="Magic Background">

                         <div class="rpg-visual-container">
                             <img src="image/boycard.png" class="rpg-char-img static-pose" alt="Walker Static">
                             <video class="rpg-char-vid loop-anim" muted loop playsinline preload="metadata">
                                 <source src="video/boy_loop.mp4" type="video/mp4">
                             </video>
                         </div>

                        <img src="image/guidepure.png" class="rpg-faction-logo" alt="Logo 1">
                    </div>
                    <div class="rpg-card-stats">
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-flask rpg-stat-icon"></i>
                            <span class="rpg-stat-label">MANA</span>
                            <span class="rpg-stat-val">70</span>
                        </div>
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-khanda rpg-stat-icon"></i>
                            <span class="rpg-stat-label" style="color:#00BFFF;">ATK</span>
                            <span class="rpg-stat-val">85</span>
                        </div>
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-heart rpg-stat-icon"></i>
                            <span class="rpg-stat-label">LIFE</span>
                            <span class="rpg-stat-val">65</span>
                        </div>
                    </div>
                </div>
                <div class="rpg-data-panel">
                    <h3 class="rpg-section-title" style="border-color:#00BFFF;">Attribute Analysis</h3>
                    <div class="charts-row">
                        <div class="radar-box"><canvas id="radarWalker"></canvas></div>
                        <div class="bar-box"><canvas id="barWalker"></canvas></div>
                    </div>
                    <div class="rpg-desc-box">
                        <h4>Class Overview: Void Navigator</h4>
                        <p>A balanced fighter with a focus on offensive magic. He uses precise elemental spells to stabilize unstable timelines and clear obstacles. His combat readiness is vital for survival.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="detail-weaver" class="char-stats-section">
        <div class="container">
            <div class="rpg-layout-grid">
                <div class="rpg-card">
                    <div class="rpg-card-visual">
                        <span class="rpg-badge" style="background:#C2412E;">MENTOR</span>
                        <span class="rpg-name">Time Weaver</span>
                        <div class="rpg-watermark">KEEPER</div>
                        <img src="image/magic_circle_bg.png" class="rpg-bg-texture" alt="Magic Background">

                         <div class="rpg-visual-container">
                             <img src="image/bearcard.png" class="rpg-char-img static-pose" alt="Weaver Static">
                             <video class="rpg-char-vid loop-anim" muted loop playsinline preload="metadata">
                                 <source src="video/bear_loop.mp4" type="video/mp4">
                             </video>
                         </div>

                        <img src="image/starpure.png" class="rpg-faction-logo" alt="Logo 2">
                    </div>
                    <div class="rpg-card-stats">
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-flask rpg-stat-icon"></i>
                            <span class="rpg-stat-label">MANA</span>
                            <span class="rpg-stat-val">80</span>
                        </div>
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-khanda rpg-stat-icon"></i>
                            <span class="rpg-stat-label">ATK</span>
                            <span class="rpg-stat-val">45</span>
                        </div>
                        <div class="rpg-stat-item">
                            <i class="fa-solid fa-heart rpg-stat-icon"></i>
                            <span class="rpg-stat-label" style="color:#C2412E;">LIFE</span>
                            <span class="rpg-stat-val">90</span>
                        </div>
                    </div>
                </div>
                <div class="rpg-data-panel">
                    <h3 class="rpg-section-title" style="border-color:#C2412E;">Attribute Analysis</h3>
                    <div class="charts-row">
                        <div class="radar-box"><canvas id="radarWeaver"></canvas></div>
                        <div class="bar-box"><canvas id="barWeaver"></canvas></div>
                    </div>
                    <div class="rpg-desc-box">
                        <h4>Class Overview: Construct Master</h4>
                        <p>With massive life pools and shielding capabilities, he acts as the team's anchor. He shapes raw time energy into protective constructs and guides the apprentices.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="landscapes">
        <div id="globe-canvas-container"></div>
        
        <div id="center-info-display">
            <img id="center-loc-logo" src="" alt="Location Logo">
            <h2>Lost Landscapes</h2>
            <p>Explore the distorted realities where the shards are hidden.</p>
            <a href="#" id="center-go-btn" target="_blank">GO TO</a>
        </div>

        <div id="hologram-ui-overlay">
            <svg id="connector-lines-svg" width="100%" height="100%"></svg>
            
            <div class="location-buttons-container buttons-left">
                <button class="hologram-btn" id="btn-desert">
                    Amber Desert
                    <span class="btn-subtitle">Near Egypt</span>
                </button>
            </div>

            <div class="location-buttons-container buttons-right">
                <button class="hologram-btn" id="btn-sea">
                    Starlight Sea
                    <span class="btn-subtitle">Mariana Trench</span>
                </button>
                <button class="hologram-btn" id="btn-meadow">
                    Boundless Meadow
                    <span class="btn-subtitle">Mongolia</span>
                </button>
            </div>

            <div id="globe-marker-label" class="globe-marker-label">Target Location</div>
        </div>
    </section>
	<section id="final-scene"></section>
    <footer><p>Messenger Guild Worldview © 2025. All Rights Reserved.</p></footer>

    <script>
            document.addEventListener('DOMContentLoaded', function() {
                /* --- TRANSITION LOGIC --- */
                function playTransition(targetId) {
                    const transOverlay = document.getElementById('transition-overlay');
                    const blackFade = document.getElementById('black-fade-overlay'); 
                    const targetSection = document.getElementById(targetId);
                    if (!transOverlay || !targetSection || !blackFade) return;
                    transOverlay.style.display = 'block'; void transOverlay.offsetWidth; 
                    transOverlay.classList.add('watch-active'); blackFade.style.opacity = '1';
                    setTimeout(() => { targetSection.scrollIntoView({ behavior: 'auto', block: 'start' }); }, 800);
                    setTimeout(() => { blackFade.style.opacity = '0'; }, 1000);
                    setTimeout(() => { transOverlay.style.display = 'none'; transOverlay.classList.remove('watch-active'); }, 2000);
                }
                document.querySelectorAll('.guardian-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const target = this.getAttribute('data-target');
                        if (target) playTransition(target);
                    });
                });
    
                /* --- VIDEO HOVER LOGIC --- */
                const charVisuals = document.querySelectorAll('.char-stats-section .rpg-card-visual');
                charVisuals.forEach(visual => {
                    const video = visual.querySelector('.rpg-char-vid');
                    if (!video) return;
                    visual.addEventListener('mouseenter', () => {
                        visual.classList.add('is-hovering');
                        if (video.readyState >= 2) { video.play().catch(e => console.error("Error:", e)); } 
                        else { video.oncanplay = () => video.play().catch(e => console.error("Error:", e)); }
                    });
                    visual.addEventListener('mouseleave', () => {
                        visual.classList.remove('is-hovering');
                        video.pause(); video.currentTime = 0;
                    });
                });
    
                /* --- CHART.JS CONFIGURATION --- */
                const labels = ['Mana', 'Agility', 'Luck', 'Defense', 'Attack'];
                const tooltipOptions = { titleFont: { size: 24, family: 'Nunito' }, bodyFont: { size: 20, family: 'Nunito' }, padding: 15, cornerRadius: 10 };
                const getRadarConfig = (data, color, borderColor) => ({ type: 'radar', data: { labels: labels, datasets: [{ data: data, backgroundColor: color + '66', borderColor: borderColor, pointBackgroundColor: '#fff', borderWidth: 3 }] }, options: { scales: { r: { angleLines: { color: 'rgba(255, 255, 255, 0.2)' }, grid: { color: 'rgba(255, 255, 255, 0.1)' }, pointLabels: { color: borderColor, font: { size: 27, family: 'Nunito', weight: 'bold' } }, ticks: { display: false, max: 100 } } }, plugins: { legend: { display: false }, tooltip: tooltipOptions }, maintainAspectRatio: false } });
                const getBarConfig = (data, color) => ({ type: 'bar', data: { labels: labels, datasets: [{ data: data, backgroundColor: color, borderRadius: 20, barThickness: 30 }] }, options: { indexAxis: 'y', scales: { x: { display: false, max: 100 }, y: { ticks: { color: '#fff', font: { family: 'Nunito', size: 36, weight: 'bold' } }, grid: { display: false } } }, plugins: { legend: { display: false }, tooltip: tooltipOptions }, maintainAspectRatio: false } });
    
                const girlData = [96, 60, 80, 20, 30]; const girlColor = '#FFD700';
                new Chart(document.getElementById('radarResonator'), getRadarConfig(girlData, girlColor, girlColor));
                new Chart(document.getElementById('barResonator'), getBarConfig(girlData, girlColor));
                const boyData = [70, 75, 50, 60, 85]; const boyColor = '#00BFFF';
                new Chart(document.getElementById('radarWalker'), getRadarConfig(boyData, boyColor, boyColor));
                new Chart(document.getElementById('barWalker'), getBarConfig(boyData, boyColor));
                const bearData = [80, 30, 60, 90, 45]; const bearColor = '#C2412E';
                new Chart(document.getElementById('radarWeaver'), getRadarConfig(bearData, bearColor, bearColor));
                new Chart(document.getElementById('barWeaver'), getBarConfig(bearData, bearColor));
    
                /* --- PARTICLE SYSTEM --- */
                const canvasTrail = document.getElementById('magic-trail');
                const ctxTrail = canvasTrail.getContext('2d');
                const storySection = document.getElementById('story');
                function resizeCanvasTrail() { canvasTrail.width = storySection.offsetWidth; canvasTrail.height = storySection.offsetHeight; }
                resizeCanvasTrail(); window.addEventListener('resize', resizeCanvasTrail);
                let particlesArray = []; const PARTICLE_LIFETIME = 3000;
                class Particle { constructor(x, y, isStatic = false) { this.x = x; this.y = y; this.isStatic = isStatic; if (isStatic) { this.baseX = x; this.baseY = y; this.speedX = 0; this.speedY = 0; this.color = 'rgba(165, 243, 252, ' + (Math.random() * 0.5 + 0.5) + ')'; this.size = Math.random() * 2 + 1; } else { this.speedX = Math.random() * 0.6 - 0.3; this.speedY = Math.random() * 0.6 - 0.3; this.color = 'rgba(165, 243, 252, ' + Math.random() + ')'; this.birthTime = Date.now(); this.size = Math.random() * 3 + 1; } } update() { if (this.isStatic) { this.x = this.baseX + (Math.random() * 1 - 0.5); this.y = this.baseY + (Math.random() * 1 - 0.5); if(Math.random() > 0.9) { this.size = Math.random() * 3 + 1; } } else { this.x += this.speedX; this.y += this.speedY; const age = Date.now() - this.birthTime; if (age > PARTICLE_LIFETIME) { if (this.size > 0.1) this.size -= 0.1; } } } draw() { ctxTrail.fillStyle = this.color; ctxTrail.beginPath(); ctxTrail.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctxTrail.shadowBlur = this.isStatic ? 8 : 5; ctxTrail.shadowColor = '#a5f3fc'; ctxTrail.fill(); ctxTrail.shadowBlur = 0; } }
                function handleParticles() { for (let i = 0; i < particlesArray.length; i++) { particlesArray[i].update(); particlesArray[i].draw(); if (!particlesArray[i].isStatic && particlesArray[i].size <= 0.3) { particlesArray.splice(i, 1); i--; } } }
                function animateTrail() { ctxTrail.clearRect(0, 0, canvasTrail.width, canvasTrail.height); handleParticles(); requestAnimationFrame(animateTrail); }
                animateTrail();
                storySection.addEventListener('mousemove', function(e) { const rect = storySection.getBoundingClientRect(); const mouseX = e.clientX - rect.left; const mouseY = e.clientY - rect.top; for (let i = 0; i < 4; i++) { particlesArray.push(new Particle(mouseX, mouseY, false)); } });
                function createMagicCircleParticles(centerX, centerY) { const r1 = 160; const r2 = 180; for(let theta = 0; theta < Math.PI * 2; theta += 0.02) { particlesArray.push(new Particle(centerX + r1 * Math.cos(theta), centerY + r1 * Math.sin(theta), true)); particlesArray.push(new Particle(centerX + r2 * Math.cos(theta), centerY + r2 * Math.sin(theta), true)); } const rStar = 140; const t1_p1 = { x: centerX + rStar * Math.cos(0 - Math.PI/2), y: centerY + rStar * Math.sin(0 - Math.PI/2) }; const t1_p2 = { x: centerX + rStar * Math.cos(2*Math.PI/3 - Math.PI/2), y: centerY + rStar * Math.sin(2*Math.PI/3 - Math.PI/2) }; const t1_p3 = { x: centerX + rStar * Math.cos(4*Math.PI/3 - Math.PI/2), y: centerY + rStar * Math.sin(4*Math.PI/3 - Math.PI/2) }; const t2_p1 = { x: centerX + rStar * Math.cos(Math.PI/3 - Math.PI/2), y: centerY + rStar * Math.sin(Math.PI/3 - Math.PI/2) }; const t2_p2 = { x: centerX + rStar * Math.cos(Math.PI - Math.PI/2), y: centerY + rStar * Math.sin(Math.PI - Math.PI/2) }; const t2_p3 = { x: centerX + rStar * Math.cos(5*Math.PI/3 - Math.PI/2), y: centerY + rStar * Math.sin(5*Math.PI/3 - Math.PI/2) }; function drawLine(pStart, pEnd) { const dist = Math.sqrt((pEnd.x - pStart.x)**2 + (pEnd.y - pStart.y)**2); const steps = dist / 2; for(let i=0; i<=steps; i++) { const t = i/steps; const px = pStart.x + (pEnd.x - pStart.x) * t; const py = pStart.y + (pEnd.y - pStart.y) * t; particlesArray.push(new Particle(px, py, true)); } } drawLine(t1_p1, t1_p2); drawLine(t1_p2, t1_p3); drawLine(t1_p3, t1_p1); drawLine(t2_p1, t2_p2); drawLine(t2_p2, t2_p3); drawLine(t2_p3, t2_p1); }
                storySection.addEventListener('click', function(e) { const rect = storySection.getBoundingClientRect(); const mouseX = e.clientX - rect.left; const mouseY = e.clientY - rect.top; createMagicCircleParticles(mouseX, mouseY); const xPercent = (mouseX / rect.width) * 100; const yPercent = (mouseY / rect.height) * 100; storySection.style.transformOrigin = `${xPercent}% ${yPercent}%`; setTimeout(() => { storySection.classList.add('section-collapsing'); }, 800); setTimeout(() => { document.getElementById('guardians').scrollIntoView({ behavior: 'smooth' }); setTimeout(() => { storySection.classList.remove('section-collapsing'); storySection.style.transformOrigin = 'center center'; particlesArray = particlesArray.filter(p => !p.isStatic); }, 1000); }, 1800); });
    
                /* --- VIDEO & TRANSITION LOGIC --- */
                const startBtn = document.getElementById('startBtn');
                const video = document.getElementById('introVideo');
                const heroSection = document.getElementById('heroSection');
                const navbar = document.getElementById('navbar');
                const transOverlay = document.getElementById('transition-overlay');
                const blackFade = document.getElementById('black-fade-overlay');
                const storySec = document.getElementById('story');
                startBtn.addEventListener('click', function(e) { e.preventDefault(); heroSection.classList.add('video-mode'); document.body.classList.add('noscroll'); video.currentTime = 0; video.play(); });
                video.addEventListener('ended', function() { storySec.classList.add('story-hidden'); transOverlay.style.display = 'block'; void transOverlay.offsetWidth; transOverlay.classList.add('watch-active'); blackFade.style.opacity = '1'; setTimeout(() => { document.body.classList.remove('noscroll'); storySec.scrollIntoView({ behavior: 'auto', block: 'start' }); setTimeout(() => { storySec.classList.remove('story-hidden'); }, 100); }, 800); setTimeout(() => { blackFade.style.opacity = '0'; }, 1000); setTimeout(() => { transOverlay.style.display = 'none'; transOverlay.classList.remove('watch-active'); heroSection.classList.remove('video-mode'); video.pause(); }, 2000); });
                window.addEventListener('scroll', function() { if (window.scrollY > 50) { navbar.classList.add('scrolled'); } else { navbar.classList.remove('scrolled'); } });
    
                /* =========================================
                   [HOLOGRAPHIC EARTH - REAL CONTINENTS]
                   ========================================= */
                const globeContainer = document.getElementById('globe-canvas-container');
                const landscapesSection = document.getElementById('landscapes');
                const centerInfo = document.getElementById('center-info-display');
                let scene, camera, renderer, globeGroup, markerMesh;
                let isGlobeInitialized = false;
                
                // [UPDATED] Coordinates with Logos & URLs
                const locations = {
                    'btn-desert': { 
                        lat: 26.0, lon: 30.0, 
                        name: "Amber Desert", 
                        coordText: "N 26°00′ E 30°00′",
                        logo: "image/dustlogo.png",
                        url: "dust.html" 
                    }, 
                    'btn-sea': { 
                        lat: 11.0, lon: 142.0, 
                        name: "Starlight Sea", 
                        coordText: "N 11°00′ E 142°00′",
                        logo: "image/oceanlogo.png",
                        url: "ocean.html"
                    }, 
                    'btn-meadow': { 
                        lat: 47.0, lon: 103.0, 
                        name: "Boundless Meadow", 
                        coordText: "N 47°00′ E 103°00′",
                        logo: "image/grasslogo.png",
                        url: "grass.html"
                    }
                };
    
                const svgLine = document.getElementById('connector-lines-svg');
                const label = document.getElementById('globe-marker-label');
                const centerLogo = document.getElementById('center-loc-logo'); 
                const goBtn = document.getElementById('center-go-btn'); 
                
                let activeBtn = null;
                let targetVector = new THREE.Vector3();
    
                function createContinentTexture() {
                    const c = document.createElement('canvas');
                    c.width = 1024; c.height = 512;
                    const ctx = c.getContext('2d');
                    ctx.fillStyle = 'black'; ctx.fillRect(0,0,1024,512);
                    ctx.fillStyle = 'white';
                    ctx.beginPath(); ctx.moveTo(250,50); ctx.lineTo(350,150); ctx.lineTo(300,250); ctx.lineTo(200,100); ctx.fill();
                    ctx.beginPath(); ctx.moveTo(320,260); ctx.lineTo(400,350); ctx.lineTo(350,480); ctx.lineTo(280,300); ctx.fill();
                    ctx.beginPath(); ctx.moveTo(480,50); ctx.lineTo(850,50); ctx.lineTo(900,200); ctx.lineTo(800,350); ctx.lineTo(600,300); ctx.lineTo(550,450); ctx.lineTo(450,250); ctx.fill();
                    ctx.beginPath(); ctx.arc(880, 400, 40, 0, 6.28); ctx.fill();
                    return c;
                }
    
                function initGlobe() {
                    scene = new THREE.Scene();
                    camera = new THREE.PerspectiveCamera(50, globeContainer.offsetWidth / globeContainer.offsetHeight, 0.1, 1000);
                    camera.position.z = 200;
    
                    renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                    renderer.setSize(globeContainer.offsetWidth, globeContainer.offsetHeight);
                    renderer.setPixelRatio(window.devicePixelRatio);
                    globeContainer.appendChild(renderer.domElement);
    
                    globeGroup = new THREE.Group();
                    scene.add(globeGroup);
    
                    const coreGeo = new THREE.SphereGeometry(69, 64, 64);
                    const coreMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
                    const core = new THREE.Mesh(coreGeo, coreMat);
                    globeGroup.add(core);
    
                    const gridGeo = new THREE.WireframeGeometry(new THREE.SphereGeometry(70, 32, 32));
                    const gridMat = new THREE.LineBasicMaterial({ 
                        color: 0xa5f3fc, 
                        transparent: true, 
                        opacity: 0.8,
                        blending: THREE.AdditiveBlending 
                    });
                    const gridSphere = new THREE.LineSegments(gridGeo, gridMat);
                    globeGroup.add(gridSphere);
    
                    const mapCanvas = createContinentTexture();
                    const imgData = mapCanvas.getContext('2d').getImageData(0,0,1024,512);
                    
                    const particlesGeo = new THREE.BufferGeometry();
                    const vertices = [];
    
                    for (let y = 0; y < 512; y+=4) { 
                        for (let x = 0; x < 1024; x+=4) {
                            const i = (y * 1024 + x) * 4;
                            if (imgData.data[i] > 100) { 
                                const lat = (y / 512) * 180 - 90;
                                const lon = (x / 1024) * 360 - 180;
                                const r = 70.2; 
                                const phi = (90 - lat) * (Math.PI / 180);
                                const theta = (lon + 180) * (Math.PI / 180);
                                const vx = -(r * Math.sin(phi) * Math.cos(theta));
                                const vz = (r * Math.sin(phi) * Math.sin(theta));
                                const vy = (r * Math.cos(phi));
                                vertices.push(vx, vy, vz);
                            }
                        }
                    }
                    particlesGeo.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                    const particlesMat = new THREE.PointsMaterial({ 
                        color: 0x000000, 
                        size: 1.5,
                        transparent: false
                    });
                    const earthPoints = new THREE.Points(particlesGeo, particlesMat);
                    globeGroup.add(earthPoints);
    
                    const markerGeo = new THREE.SphereGeometry(0.2, 16, 16);
                    const markerMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0 });
                    markerMesh = new THREE.Mesh(markerGeo, markerMat);
                    globeGroup.add(markerMesh);
    
                    window.addEventListener('resize', onWindowResize);
                    animateGlobe();
                }
    
                function latLonToVector3(lat, lon, radius) {
                    const phi = (90 - lat) * (Math.PI / 180);
                    const theta = (lon + 180) * (Math.PI / 180);
                    const x = -(radius * Math.sin(phi) * Math.cos(theta));
                    const z = (radius * Math.sin(phi) * Math.sin(theta));
                    const y = (radius * Math.cos(phi));
                    return new THREE.Vector3(x, y, z);
                }
    
                function onWindowResize() {
                    camera.aspect = globeContainer.offsetWidth / globeContainer.offsetHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(globeContainer.offsetWidth, globeContainer.offsetHeight);
                }
    
                function animateGlobe() {
                    requestAnimationFrame(animateGlobe);
                    if (!activeBtn) {
                        globeGroup.rotation.y += 0.002;
                    }
                    renderer.render(scene, camera);
                    updateConnectorLine();
                }
    
                function updateConnectorLine() {
                    if (!activeBtn || !markerMesh) return;
                    targetVector.setFromMatrixPosition(markerMesh.matrixWorld);
                    targetVector.project(camera);
                    const w = globeContainer.offsetWidth;
                    const h = globeContainer.offsetHeight;
                    const targetX = (targetVector.x * 0.5 + 0.5) * w;
                    const targetY = -(targetVector.y * 0.5 - 0.5) * h;
    
                    const btnRect = activeBtn.getBoundingClientRect();
                    const sectionRect = landscapesSection.getBoundingClientRect();
                    const btnX = (btnRect.left + btnRect.width / 2) - sectionRect.left;
                    const btnY = (btnRect.top + btnRect.height / 2) - sectionRect.top;
    
                    svgLine.innerHTML = `<line class="connector-line" x1="${btnX}" y1="${btnY}" x2="${targetX}" y2="${targetY}"/>`;
                    label.style.left = `${targetX}px`;
                    label.style.top = `${targetY}px`;
                }
    
                document.querySelectorAll('.hologram-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const locId = this.id;
                        const locData = locations[locId];
                        activeBtn = this;
    
                        const h2 = centerInfo.querySelector('h2');
                        const p = centerInfo.querySelector('p');
                        h2.innerText = locData.name;
                        p.innerText = locData.coordText;
                        p.classList.add('coord-active');
    
                        centerLogo.src = locData.logo;
                        centerLogo.classList.add('center-logo-active');
    
                        goBtn.href = locData.url;
                        goBtn.classList.add('visible');
    
                        label.textContent = "TARGET LOCKED";
                        label.classList.add('active');
                        markerMesh.material.opacity = 1;
    
                        const localPos = latLonToVector3(locData.lat, locData.lon, 70);
                        markerMesh.position.copy(localPos);
    
                        gsap.to(globeGroup.rotation, {
                            duration: 1.5,
                            x: (locData.lat * (Math.PI/180)) * 0.1, 
                            y: -((locData.lon + 90) * (Math.PI/180)), 
                            ease: "power2.out"
                        });
    
                        gsap.to(camera.position, {
                            duration: 1.5,
                            z: 140,
                            ease: "power2.out"
                        });
                    });
                });
    
                landscapesSection.addEventListener('click', function() {
                    if(activeBtn) {
                        activeBtn = null;
                        label.classList.remove('active');
                        markerMesh.material.opacity = 0;
                        svgLine.innerHTML = '';
                        
                        centerLogo.classList.remove('center-logo-active');
                        goBtn.classList.remove('visible');
    
                        const h2 = centerInfo.querySelector('h2');
                        const p = centerInfo.querySelector('p');
                        h2.innerText = "Lost Landscapes";
                        p.innerText = "Explore the distorted realities where the shards are hidden.";
                        p.classList.remove('coord-active'); 
    
                        gsap.to(camera.position, { duration: 1.5, z: 200, ease: "power2.out" });
                    }
                });
    
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !isGlobeInitialized) {
                            initGlobe();
                            isGlobeInitialized = true;
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(landscapesSection);
    
                /* --- [NEW] RESTORE STATE LOGIC --- */
                // Check if we returned from a sub-page (e.g., ?restore=btn-desert)
                const urlParams = new URLSearchParams(window.location.search);
                const restoreTarget = urlParams.get('restore');
    
                if (restoreTarget && locations[restoreTarget]) {
                    // Force init globe immediately if it hasn't started yet
                    if (!isGlobeInitialized) {
                        initGlobe();
                        isGlobeInitialized = true;
                    }
                    
                    // Simulate a click on the target button to restore state (Logo, GO TO btn, etc.)
                    const targetBtn = document.getElementById(restoreTarget);
                    if (targetBtn) {
                        // Slight delay to ensure DOM and GL context are ready
                        setTimeout(() => {
                            targetBtn.click();
                        }, 100);
                    }
                }
            });
        </script>
</body>
</html>